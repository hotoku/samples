#standardSQL

-- unnestによって、どういうデータが返ってくるのか確認する
-- 複数レコードの場合

with t as (
  select 1 as a, [1,2,3] as b, [10, 20, 30] as c
  union all
  select 2 as a, [100, 200, 300] as b, [1000, 2000, 3000] as c
)
select
  *
from
  t, unnest(b) as b_, unnest(c) as c_

-- +---+---------------------+------------------------+-----+------+
-- | a |          b          |           c            | b_  |  c_  |
-- +---+---------------------+------------------------+-----+------+
-- | 1 |       ["1","2","3"] |       ["10","20","30"] |   1 |   10 |
-- | 1 |       ["1","2","3"] |       ["10","20","30"] |   1 |   20 |
-- | 1 |       ["1","2","3"] |       ["10","20","30"] |   1 |   30 |
-- | 1 |       ["1","2","3"] |       ["10","20","30"] |   2 |   10 |
-- | 1 |       ["1","2","3"] |       ["10","20","30"] |   2 |   20 |
-- | 1 |       ["1","2","3"] |       ["10","20","30"] |   2 |   30 |
-- | 1 |       ["1","2","3"] |       ["10","20","30"] |   3 |   10 |
-- | 1 |       ["1","2","3"] |       ["10","20","30"] |   3 |   20 |
-- | 1 |       ["1","2","3"] |       ["10","20","30"] |   3 |   30 |
-- | 2 | ["100","200","300"] | ["1000","2000","3000"] | 100 | 1000 |
-- | 2 | ["100","200","300"] | ["1000","2000","3000"] | 100 | 2000 |
-- | 2 | ["100","200","300"] | ["1000","2000","3000"] | 100 | 3000 |
-- | 2 | ["100","200","300"] | ["1000","2000","3000"] | 200 | 1000 |
-- | 2 | ["100","200","300"] | ["1000","2000","3000"] | 200 | 2000 |
-- | 2 | ["100","200","300"] | ["1000","2000","3000"] | 200 | 3000 |
-- | 2 | ["100","200","300"] | ["1000","2000","3000"] | 300 | 1000 |
-- | 2 | ["100","200","300"] | ["1000","2000","3000"] | 300 | 2000 |
-- | 2 | ["100","200","300"] | ["1000","2000","3000"] | 300 | 3000 |
-- +---+---------------------+------------------------+-----+------+

-- unnestの結果は、フルにcross joinされるのでなく、元々同じレコードにいた者同士でだけ
-- cross joinされる
